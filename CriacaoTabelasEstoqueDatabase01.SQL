/* ---------------------------------
   EXCLUINDO AS TABELAS
   --------------------------------- */

-- Conectar com o usuário VENDAS

DROP TABLE T_ITEM_NF;
DROP TABLE T_NOTA_FISCAL;
DROP TABLE T_CLIENTE;


-- Conectar com o usuário ESTOQUE

DROP TABLE T_MOV_PRODUTO;
DROP TABLE T_PRODUTO;
DROP TABLE T_UNIDADE_MEDIDA;
DROP TABLE T_GRUPO_PROD;

-- Conectar com o usuário FOLHA

DROP TABLE T_FUNCIONARIO;
DROP TABLE T_DEPARTAMENTO;

/* ---------------------------------
   CRIANDO AS TABELAS
   --------------------------------- */

-- Conectar com o usuário FOLHA
CREATE TABLE T_DEPARTAMENTO
(COD_DEPTO             NUMBER(2),
 NOM_DEPTO             VARCHAR2(30),
 SIGLA_DEPTO           VARCHAR2(5),
 CONSTRAINT PK_DEPTO PRIMARY KEY (COD_DEPTO)
);

CREATE TABLE T_FUNCIONARIO
(MATRIC                NUMBER(05),
 NOME                  VARCHAR2(30),
 DAT_ADMISS            DATE,
 COD_DEPTO             NUMBER(2),
 CONSTRAINT PK_FUNC PRIMARY KEY (MATRIC),
 CONSTRAINT FK_FUNC_DEPTO FOREIGN KEY (COD_DEPTO)
            REFERENCES T_DEPARTAMENTO (COD_DEPTO)
);

GRANT REFERENCES, SELECT ON T_FUNCIONARIO TO ESTOQUE;
GRANT REFERENCES, SELECT ON T_FUNCIONARIO TO VENDAS;

-- Conectar com usuário ESTOQUE

CREATE  TABLE T_UNIDADE_MEDIDA
(CD_UNID_MEDIDA         VARCHAR2(03),
 DS_UNID_MEDIDA         VARCHAR2(20),
 CONSTRAINT PK_UNIDADE_MEDIDA PRIMARY KEY (CD_UNID_MEDIDA)
);

COMMENT ON TABLE  T_UNIDADE_MEDIDA IS 'TABELA DE UNIDADE DE MEDIDA';
COMMENT ON COLUMN T_UNIDADE_MEDIDA.CD_UNID_MEDIDA IS 'CODIGO DA UNIDADE DE MEDIDA';
COMMENT ON COLUMN T_UNIDADE_MEDIDA.DS_UNID_MEDIDA IS 'DESCRICAO DA UNIDASDE DE MEDIDA';

CREATE  TABLE T_GRUPO_PROD
(CD_GRUPO_PROD          NUMBER(02),
 DS_GRUPO_PROD          VARCHAR2(30),
 CONSTRAINT PK_GRUPO_PROD PRIMARY KEY (CD_GRUPO_PROD)
);

COMMENT ON TABLE  T_GRUPO_PROD IS 'TABELA DE GRUPOS DE PRODUTO.PEX. LATICINIOS, PAPELARIA';
COMMENT ON COLUMN T_GRUPO_PROD.CD_GRUPO_PROD IS 'CODIGO DO GRUPO DE PRODUTOS';
COMMENT ON COLUMN T_GRUPO_PROD.CD_GRUPO_PROD IS 'DESCRICAO DO GRUPO DE PRODUTOS';

CREATE TABLE T_PRODUTO
(COD_PRODUTO            NUMBER(05),
 NOM_PRODUTO            VARCHAR2(30),
 CD_GRUPO_PROD          NUMBER(02),
 CD_UNID_MEDIDA         VARCHAR2(03),
 VL_UNITARIO            NUMBER(07,2),
 SALDO_ESTOQUE          NUMBER(07,2),
 QTD_ESTOQ_MIN          NUMBER(07,2),
 QTD_PTO_PEDIDO         NUMBER(07,2),
 CONSTRAINT PK_PRODUTO  PRIMARY KEY (COD_PRODUTO),
 CONSTRAINT FK_PRODUTO_GRUPO FOREIGN KEY (CD_GRUPO_PROD)
            REFERENCES T_GRUPO_PROD (CD_GRUPO_PROD),
 CONSTRAINT FK_PRODUTO_UNID_MEDIDA FOREIGN KEY (CD_UNID_MEDIDA)
            REFERENCES T_UNIDADE_MEDIDA (CD_UNID_MEDIDA)
);

COMMENT ON TABLE  T_PRODUTO IS 'TABELA DE PRODUTOS';
COMMENT ON COLUMN T_PRODUTO.COD_PRODUTO IS 'CODIGO DO PRODUTO';
COMMENT ON COLUMN T_PRODUTO.NOM_PRODUTO IS 'NOME DO PRODUTO';
COMMENT ON COLUMN T_PRODUTO.CD_GRUPO_PROD IS 'CODIGO DO GRUPO DO PRODUTO FK:T_GRUPO_PRODUTO';
COMMENT ON COLUMN T_PRODUTO.CD_UNID_MEDIDA IS 'CODIGO DA UNIDADE DE MEDIDA FK(T_UNIDADE MEDIDA';
COMMENT ON COLUMN T_PRODUTO.VL_UNITARIO IS 'VALOR UNITARIO DO PRODUTO';
COMMENT ON COLUMN T_PRODUTO.SALDO_ESTOQUE IS 'SALDO ATUAL EM ESTOQUE';
COMMENT ON COLUMN T_PRODUTO.QTD_ESTOQ_MIN IS 'QUANTIDADE EM ESTOQUE MINIMO PARA VENDA';
COMMENT ON COLUMN T_PRODUTO.QTD_PTO_PEDIDO IS 'QUANTIDADE QUE QUANDO ATINGIDA DEVERA SER FEITO UM NOVO PEDIDO';

CREATE TABLE T_MOV_PRODUTO
(COD_PRODUTO           NUMBER(05),
 NUM_MOVIM             NUMBER(05),
 DAT_MOVIM             DATE,
 TIP_MOVIM             CHAR(01),
 QTD_MOVIM             NUMBER(03),
 MATR_FUNC_MOV         NUMBER(05),
 CONSTRAINT PK_MOV_PRODUTO PRIMARY KEY (COD_PRODUTO, NUM_MOVIM),
 CONSTRAINT FK_MOV_PRODUTO_PRODUTO FOREIGN KEY (COD_PRODUTO)
            REFERENCES T_PRODUTO (COD_PRODUTO),
 CONSTRAINT CK_MOV_PRODUTO_TIPO CHECK (TIP_MOVIM IN ('E','S')),
 CONSTRAINT FK_MOV_PRODUTO_FUNC FOREIGN KEY (MATR_FUNC_MOV)
            REFERENCES FOLHA.T_FUNCIONARIO (MATRIC) 
);

COMMENT ON TABLE  T_MOV_PRODUTO IS 'TABELA QUE REGISTRA A MOVIMENTACAO DE PRODUTOS. ENTRADA E SAIDA';
COMMENT ON COLUMN T_MOV_PRODUTO.COD_PRODUTO IS 'CODIGO DO PRODUTO FK:T_PRODUTO';
COMMENT ON COLUMN T_MOV_PRODUTO.NUM_MOVIM IS 'NUMERO SEQUENCOAL DA MOVIMENTACAO DO PRODUTO';
COMMENT ON COLUMN T_MOV_PRODUTO.DAT_MOVIM IS 'DATA DA MOVIMENTACAO';
COMMENT ON COLUMN T_MOV_PRODUTO.TIP_MOVIM IS 'TIPO DE MOVIMENTACAO E-ENTRADA, S-SAIDA';
COMMENT ON COLUMN T_MOV_PRODUTO.QTD_MOVIM IS 'QUANTIDADE MOVIMENTADA';

GRANT REFERENCES, SELECT ON T_PRODUTO TO VENDAS;

-- Conectar ao usuário VENDAS

CREATE TABLE T_CLIENTE
(COD_CLIENTE      NUMBER(5),
 NOME_CLIENTE     VARCHAR2(30),
 CONSTRAINT PK_CLIENTE PRIMARY KEY (COD_CLIENTE)
);

CREATE TABLE T_NOTA_FISCAL
(NUM_NF      NUMBER(7),
 DATA_NF     DATE,
 COD_CLIENTE NUMBER(5),
 MATR_FUNC_EMI NUMBER(5),
 CONSTRAINT PK_NF PRIMARY KEY (NUM_NF),
 CONSTRAINT FK_NF_CLIENTE FOREIGN KEY (COD_CLIENTE)
            REFERENCES T_CLIENTE (COD_CLIENTE),
 CONSTRAINT FK_NF_FUNC FOREIGN KEY (MATR_FUNC_EMI)
            REFERENCES FOLHA.T_FUNCIONARIO (MATRIC)
);

CREATE TABLE T_ITEM_NF
(NUM_NF      NUMBER(7),
 COD_PRODUTO NUMBER(5),
 QTDE        NUMBER(9,2),
 VL_UNITARIO NUMBER(9,2),
 CONSTRAINT PK_ITEM_NF PRIMARY KEY (NUM_NF, COD_PRODUTO),
 CONSTRAINT FK_ITEM_NF_NF FOREIGN KEY (NUM_NF)
            REFERENCES T_NOTA_FISCAL (NUM_NF),
 CONSTRAINT FK_ITEM_NF_PRODUTO FOREIGN KEY (COD_PRODUTO)
            REFERENCES ESTOQUE.T_PRODUTO (COD_PRODUTO)
);


